----------------------------------------------------------------------------------------------------
module private tasks =
-- Tasks.
-- Flex Standard Library
-- Copyright (C) 1999-2003 A && L soft
----------------------------------------------------------------------------------------------------

with
  flex.tasks;

----------------------------------------------------------------------------------------------------
procedure internal_task_helper : t_rtl_task_entry =
----------------------------------------------------------------------------------------------------
begin
  p_task(selfptr:unchecked)^.run(userdata);
  end internal_task_helper;


----------------------------------------------------------------------------------------------------
class private abstract c_task = 
----------------------------------------------------------------------------------------------------
var
  reference        : aliased t_rtl_task_ref_local;

  --------------------------------------------------------------------------------------------------
  static start =
  --------------------------------------------------------------------------------------------------
  begin
    rtl_start_task(^internal_task_helper,^reference,false,,^this,userdata);
    end start;



  --------------------------------------------------------------------------------------------------
  static wait =
  --------------------------------------------------------------------------------------------------
  begin
    rtl_wait_and_finish_task(reference);
    end wait;



  --------------------------------------------------------------------------------------------------
  static kill =
  --------------------------------------------------------------------------------------------------
  begin
    rtl_kill_when_need_and_finish_task(reference);
    end kill;



  --------------------------------------------------------------------------------------------------
  exit = 
  --------------------------------------------------------------------------------------------------
  begin
    kill;
    end exit;
  end c_task;
end tasks;
